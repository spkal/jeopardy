---
title: Analysis of Jeopardy Games
author: Stephen Kaluzny
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: html_document
---

```{r echo=FALSE}
jeopardyData <-readRDS("jeopardyData.rds")
```
This is an analysis of data about Jeopardy games that is avilable at http://www.j-archive.com/.
The data includes information mainly about the players: names, home city, number of agames played, winnings, etc.
This analysis does not look at the content of the game questions (answers). 

The Data
--------
### Getting the Data
The data was scraped from the http://www.j-archive.com site using an R function that was modified from https://scraperwiki.com/scrapers/jarchive_scraper_taiwanshaun/. The function, `jscrapeDirect`, is available in the appendix. Only regular Jeopardy games were downloaded, leaving out championships, teen, college, etc tournaments. The `id` argument is a vector of show id's to scrape from the web site.

To avoid having to get the data multiple times while developing the code, the `jscrapeDirect` function can be used in two steps. First call it with `getDataOnly=TRUE` to get the raw scraped data.  Then call `jscrapeDirect` with the raw data as an input (as the `data` argument) into a second call to `jscrapeDirect` to process the raw data.

```{r eval = FALSE}
jeopardyDataRaw <- jscrapeDirect(id=1:5000)
```

### Cleaning the Data
The raw scraped data has 7 columns:
```{r eval=FALSE}
names(jeopardyDataRaw)
```
The resulting data needs to be cleaned up.
Changes made include values in the wrong column,
fixing spelling of states,
New York city boroughs changed to New York,
"now living in ..." and "now stationed at ..."
changed to the listed location.
The cleaning was an iterative process,
looking at summaries of the data, finding more errors,
making corrections.
The clean up operations were all encapsulate in a single
function, `jcleanData` that could be repeatedly run on the
`jeopardyRawData` object.
The `jcleanData` function is listed in the appendix.

Creating the dataset:
```{r eval = FALSE}
jeopardyDataRaw <- jscrapeDirect(id=1:5000)
jeopardyData <- jcleanData(jeopardyDataRaw)
```
Added variables
 * GameMaxValue
 * Gender
 * PlayerId

Analysis
---------
The final dataset has `r nrow(jeopardyData)` rows and `r ncol(jeopardyData)` columns.
Each row represents a single player in a game,
each games consists of 3 rows
i,e, we have
`r nrow(jeopardyData)` player observations and
`r nrow(jeopardyData) / 3` games.
There are `r length(unique(jeopardyData$PlayerId))` different players.
The games were played from
`r min(jeopardyData$Date)` to `r max(jeopardyData$Date)`.

Final Winnings
--------------
```{r}
# name: winnings
require(dplyr)                                                      
summary(jeopardyData[jeopardyData$IsWinner, "FinalScore"])
group_by(jeopardyData, GameMaxValue) %>%
    summarize(MedianWinnings=median(FinalScore), 
       AveWinnings=mean(FinalScore))
```
```{r fig.width=8, fig.height=8}
require(ggplot2)
filter(jeopardyData, IsWinner) %>% 
    ggplot(aes(x=FinalScore)) +
    geom_histogram()
filter(jeopardyData, IsWinner) %>% 
    ggplot(aes(x=FinalScore)) +
    geom_histogram() +
    facet_grid(GameMaxValue ~ .)

# Number of wins
group_by(jeopardyData, PlayerId) %>%
    mutate(NumberWins = n() - 1) %>%
    summarise(Wins = first(NumberWins)) %>%
    filter(Wins > 1 & Wins < 19) %>%
    ggplot(aes(x=Wins)) +
        geom_bar(binwidth=0.5) +
        coord_flip()
#
# Dollar winnings per game
filter(jeopardyData, IsWinner) %>%
    filter(FinalScore < 60000) %>%
    ggplot(aes(x=FinalScore)) +
        geom_histogram()
# Total winnings per player:
group_by(jeopardyData, PlayerId) %>%
    mutate(NumberWins = n() - 1) %>%
    summarise(Wins = first(NumberWins), Dollars = sum(FinalScore)) %>%
    filter(Wins > 0) %>%
    filter( Wins < 19) %>%
    ggplot(aes(x=Wins, y=Dollars)) +
        geom_jitter(position = position_jitter(width = .3))
# boxplot:    
group_by(jeopardyData, PlayerId) %>%
    mutate(NumberWins = n() - 1) %>%
    summarise(Wins = first(NumberWins), Dollars = sum(FinalScore)) %>%
    filter(Wins > 0) %>%
    filter(Wins < 19) %>%
    ggplot(aes(x=Wins, y=Dollars)) +
        geom_boxplot(aes(group = Wins))
```

Players by State
----------------
To see if players are equally likely to come from any U.S. state, we want to compare the number of players from each state to the state's population.

State population data was downloaded from the U.S. Census
http://www.census.gov/popest/data/state/totals/2012/tables/NST-EST2012-01.csv.
The CSV file includes aggregation data at the top and population values for multiple years.
We only extracted the data for the 50 states and the District of Columbia and only used the 2010 values.
```{r censusdata}
URL <- "http://www.census.gov/popest/data/state/totals/2012/tables/NST-EST2012-01.csv"
censusTmpFile <- tempfile()
download.file(URL, destfile=censusTmpFile)
popPipe <- pipe(paste0("sed -n -e '/Alabama/,/Wyoming/p' ", censusTmpFile, " | cut -d'\"' --output-delimiter=\";\" -f1-2 | sed -e 's/\"//' -e 's/^.//' -e 's/,//g'"))
stateDF <- read.table(popPipe, sep=";", col.names=c("State", "Population"),
    stringsAsFactors=FALSE)
stateDF[stateDF$State == "District of Columbia", "State"] <- "D.C."
```
To stanbdardize, we computed the number of players per million people in a state:
```{r}
CountPlayersByState <- table(jeopardyData$State)
i51 <- match(stateDF$State, names(CountPlayersByState))
stateDF$NPlayers <- CountPlayersByState[i51]
stateDF$PlayersPerMillion <- with(stateDF, NPlayers/Population * 1e6)
```
Plots by state:
```{r}
require(ggplot2)
p1 <- ggplot(data=stateDF, aes(x=NPlayers,
    y=ordered(State, levels=State[order(stateDF$NPlayers)])))
p1 + geom_point() + xlab("Number of Players") + ylab("State")
p2 <- ggplot(data=stateDF, aes(x=log2(PlayersPerMillion),
    y=ordered(State, levels=State[order(stateDF$PlayersPerMillion)])))
p2 + geom_point()+ xlab("Number of Players / 1 Million Population") + ylab("State")
```
Appendix
-------------------------------------------------------

The web scraper function:
```{r eval=FALSE}
```
The data cleaning function:
```{r eval=FALSE}
```
